# Решения по дизайну, а также обусловленности

Решил попробовать в качестве альтернативы p-версии.
Интуитивно кажется что может сработать.
А по практике - ну кубик сделать а там видно будет.
2023-03-15-3 делаем новое.txtOM
----
F-QUERY-NOTIFY-OVER-HTTP
Query-ответы надо по http присылать а не по ws. Хттп дешевле, проще сделать, и кип-алайв есть.
Ну для веб-клиента придется использовать прокси в районе мейна.
----
F-REACTION-REMOVE
F-QUERY-N
Query надо либо N, либо завершение запроса. В принципе равно как и реакциям - уметь их снимать.
Зачем это надо. Ну реакциям вроде как очевидно - раз можем добавить, надо уметь и снять, просто
вопросы управляемости.
N впервые возникает при реализации раннеров - ну надо запросить 1 задачку.

Но пока обошелся без этого - перевел что раннеры просто просят задачки а менеджер им посылает по 1.
Но еще N:1 возникает при exec - мы запрашивает результат вычисления 1 раз.. нам не надо чтобы
запросы видели эти, нам надо его 1 раз и можно освободить ресурсы.

Кстати как вариант развития событий - реакциям умение удаляться, а запросам N. Это будет просто
реализовать. Реакциям не надо общего состояния. А запрос - ну получит лишнее и отсечет..

Итого. Сделано у реакций - возможность их отзывать. А у query возможность указать N. Пока вроде достаточно.
----
У реакций и т.п. раньше было then для получения результата но теперь оно нужно просто для информации
что реакция разместилась. Сообразно для результата надо что-то типа code. Но code нелогично для
exec поэтому решил назвать result - единнообразно для reaction, query, exec.
Ну или done - короче писать. Но уже смешивается с then по смыслу..
Не не так. Назовем это action для реакций, и done/result для query и exec. done наверное - короче писать.
-------
И сделаем еще фишку что в query можно добавлять action - переработку сообщения на клиенте,
а в query присылать уж что там эта функция вернет (по умолчанию само сообщение).
Но формально и в query там не action а convert.
Но пока оставим.
--------
Выражение записывается из таких выражений:
{ code: идентификатор-операции, [need:true если надо ниду], arg: {словарь аргументов}}
из идей - мб заменить arg на operands.
**********
Раннеры никогда не превышают указанные им на старте лимиты. Иначе на умт задача раннера снимается.
Из этого следует, что уже при постановке задачи надо знать сколько она займет, чтобы выгрузить ненужные ниды,
да и вообще понять можно ли задачу назначать.



