# Метод итераций для графов задач. Эксперимент.

* Вычисляется функция одного переменного на регулярной сетке по явной схеме.
* Используется формула: `p_next = (p_left + p_right)/2 + Math.random(1)`
* Код функции описан в файле [f.js](f.js)

### Последовательное вычисление
[0-sequential.js](0-sequential.js) 

### Граф задач
[1-task-graph.js](1-task-graph.js) 

### Ручное распараллеливание
[2-manual.js](2-manual.js)

### Метод итераций для графа задач
[3-iter-graph.js](3-iter-graph.js) 

## Подготовка и запуск теста

```
git clone https://github.com/pavelvasev/ppk.git
cd ppk
git checkout --track origin/pavt2024
npm install
```

Запуск:
```
cd experiments/iterations
./start-many
```

## Результаты

Процессор Ryzen 1700x.
Кол-во итераций во всех тестах 1000.
P - количество исполнителей.
b - размер одного блока, тысяч ячеек.
Значения в таблицах - время в секундах.

### Сетка 100 тысяч узлов

| type       | P=2    | P=4    | P=8    | P=16   |
|            | b=50   | b=25   | b=12.5 | b=6.25 |
| ---------- | ------ | ------ | ------ | ------ |
| sequential | 1.123  | 1.125  | 1.147  | 1.118  |
| task-graph | 1.052  | 1.024  | 1.310  | 2.032  |
| iter-graph | 0.807  | 0.600  | 0.665  | 0.840  |
| manual     | 0.744  | 0.546  | 0.560  | 0.592  |

Наблюдения:
* Граф задач показывает себя особенно плохо, начиная с P=8 работает дольше последовательного случая. Вероятная причина - задачи мелкозернистые, при P=8 это 12.5 тысяч ячеек на одну задачу.
* И ручное распараллеливание, и метод итераций ухудшают свою работу начиная с P=8.
Вероятная причина - их накладные расходы это коммуникация между процессами исполнителей и она превосходит вычислительную часть. Необходимо замерять отдельно, чем именно занимаются процессы исполнителей.

### Сетка 1 миллион узлов

| type       | P=2    | P=4    | P=8    | P=16   |
|            | b=500  | b=250  | b=125  | b=62.5 |
| ---------- | ------ | ------ | ------ | ------ |
| sequential | 11.203 | 11.604 | 11.582 | 11.171 |
| task-graph | 6.648  | 3.964  | 3.825  | 3.535  |
| iter-graph | 6.414  | 3.692  | 3.246  | 2.709  |
| manual     | 6.203  | 3.646  | 2.752  | 2.372  |

### Сетка 10 миллионов узлов

| type       | P=2     | P=4     | P=8     | P=16     |
|            | b=5000  | b=2500  | b=1250  | b=625    |
| ---------- | ------- | ------- | ------- | -------- |
| sequential | 114.722 | 114.949 | 111.701 | 112.768  |
| task-graph | 60.537  | 31.185  | 21.421  | 18.269   |
| iter-graph | 59.957  | 31.443  | 21.902  | 17.523   |
| manual     | 59.233  | 30.243  | 21.518  | 17.637   |

Наблюдения для случая 10 млн:
* P=4, 8 граф задач отработал лучше чем метод итераций.
* P=16 метод итераций отработал лучше чем ручное распараллеливание.

Наиболее вероятная причина этих наблюдений - в случае сетки 10 млн задачи являются крупнозернистыми, модель графа задач для таких задач вносит меньшую долю накладных расходов.

Общее наблюдение - по видимому, есть диапазоны "зернистости" задач, где разные методы хороши или плохи. То есть "эффективность" метода это функция от размера (зерна) задачи.